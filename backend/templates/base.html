<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Rent & Electricity Billing{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #1f2937;
            --light-bg: #f8fafc;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--light-bg);
            transition: all 0.3s ease;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, var(--primary-color));
            transform: translateY(-1px);
        }

        .alert {
            border: none;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .sidebar {
            background: white;
            min-height: calc(100vh - 76px);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar .nav-link {
            color: var(--secondary-color);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 4px 0;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            color: white;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
        }

        .stats-card .card-body {
            padding: 1.5rem;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .table {
            border-radius: 12px;
            overflow: hidden;
        }

        .table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            border: none;
        }

        .badge {
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
        }

        .dark-mode {
            background-color: var(--dark-bg);
            color: white;
        }

        .dark-mode .card {
            background-color: #374151;
            color: white;
        }

        .dark-mode .sidebar {
            background-color: #374151;
        }

        .dark-mode .sidebar .nav-link {
            color: white !important;
        }

        .dark-mode .sidebar .nav-link:hover {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
            color: white !important;
        }

        .dark-mode .sidebar .nav-link.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
            color: white !important;
        }

        .dark-mode .sidebar .nav-link i {
            color: white !important;
        }

        .dark-mode .sidebar .nav-link:hover i {
            color: white !important;
        }

        .dark-mode .sidebar .nav-link.active i {
            color: white !important;
        }

        .dark-mode .sidebar h6.text-muted {
            color: #d1d5db !important;
        }

        .dark-mode .sidebar .p-3 {
            color: white;
        }

        .dark-mode .sidebar .badge {
            background-color: #ef4444 !important;
            color: white !important;
        }

        .dark-mode .sidebar .nav-link .badge {
            background-color: #ef4444 !important;
            color: white !important;
        }

        .dark-mode .table {
            background-color: #374151;
            color: white;
        }

        .dark-mode .table th {
            background-color: #4b5563;
        }

        .dark-mode .table td {
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .text-muted {
            color: #9ca3af !important;
        }

        .dark-mode .text-primary {
            color: #60a5fa !important;
        }

        .dark-mode .text-success {
            color: #10b981 !important;
        }

        .dark-mode .text-danger {
            color: #ef4444 !important;
        }

        .dark-mode .text-warning {
            color: #fbbf24 !important;
        }

        .dark-mode .text-info {
            color: #60a5fa !important;
        }

        .dark-mode .btn-outline-primary {
            color: #60a5fa;
            border-color: #60a5fa;
        }

        .dark-mode .btn-outline-primary:hover {
            background-color: #60a5fa;
            border-color: #60a5fa;
            color: #1f2937;
        }

        .dark-mode .btn-outline-secondary {
            color: #9ca3af;
            border-color: #4b5563;
        }

        .dark-mode .btn-outline-secondary:hover {
            background-color: #4b5563;
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .btn-outline-success {
            color: #10b981;
            border-color: #10b981;
        }

        .dark-mode .btn-outline-success:hover {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }

        .dark-mode .btn-outline-warning {
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .dark-mode .btn-outline-warning:hover {
            background-color: #fbbf24;
            border-color: #fbbf24;
            color: #1f2937;
        }

        .dark-mode .btn-outline-danger {
            color: #f87171;
            border-color: #f87171;
        }

        .dark-mode .btn-outline-danger:hover {
            background-color: #f87171;
            border-color: #f87171;
            color: #1f2937;
        }

        .dark-mode .badge.bg-primary {
            background-color: #3b82f6 !important;
        }

        .dark-mode .badge.bg-secondary {
            background-color: #6b7280 !important;
        }

        .dark-mode .badge.bg-success {
            background-color: #10b981 !important;
        }

        .dark-mode .badge.bg-danger {
            background-color: #ef4444 !important;
        }

        .dark-mode .badge.bg-warning {
            background-color: #fbbf24 !important;
            color: #1f2937;
        }

        .dark-mode .badge.bg-info {
            background-color: #60a5fa !important;
            color: #1f2937;
        }

        .dark-mode .alert-info {
            background-color: #1e3a8a;
            border-color: #3730a3;
            color: #93c5fd;
        }

        .dark-mode .alert-success {
            background-color: #064e3b;
            border-color: #065f46;
            color: #6ee7b7;
        }

        .dark-mode .alert-warning {
            background-color: #78350f;
            border-color: #92400e;
            color: #fcd34d;
        }

        .dark-mode .alert-danger {
            background-color: #7f1d1d;
            border-color: #991b1b;
            color: #fca5a5;
        }

        .dark-mode .bg-light {
            background-color: #4b5563 !important;
            color: white;
        }

        .dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4, .dark-mode h5, .dark-mode h6 {
            color: white !important;
        }

        .dark-mode .card-header {
            background-color: #374151 !important;
            border-bottom: 1px solid #4b5563;
            color: white;
        }

        .dark-mode .card-body {
            background-color: #374151;
            color: white;
        }

        .dark-mode .card-footer {
            background-color: #374151;
            border-top: 1px solid #4b5563;
            color: white;
        }

        .dark-mode .form-control {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: white;
        }

        .dark-mode .form-control:focus {
            background-color: #374151;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
        }

        .dark-mode .form-control::placeholder {
            color: #9ca3af;
        }

        .dark-mode .form-select {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: white;
        }

        .dark-mode .form-select:focus {
            background-color: #374151;
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
        }

        .dark-mode .btn-secondary {
            background-color: #4b5563;
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .btn-secondary:hover {
            background-color: #6b7280;
            border-color: #6b7280;
        }

        /* Additional dark mode fixes for text visibility */
        .dark-mode p, .dark-mode span, .dark-mode div, .dark-mode label {
            color: white !important;
        }

        .dark-mode .text-dark {
            color: white !important;
        }

        .dark-mode .text-body {
            color: white !important;
        }

        .dark-mode .text-secondary {
            color: #9ca3af !important;
        }

        .dark-mode .list-group-item {
            background-color: #374151;
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .list-group-item:hover {
            background-color: #4b5563;
        }

        .dark-mode .dropdown-menu {
            background-color: #374151;
            border-color: #4b5563;
        }

        .dark-mode .dropdown-item {
            color: white;
        }

        .dark-mode .dropdown-item:hover {
            background-color: #4b5563;
            color: white;
        }

        .dark-mode .modal-content {
            background-color: #374151;
            color: white;
        }

        .dark-mode .modal-header {
            background-color: #374151;
            border-bottom-color: #4b5563;
        }

        .dark-mode .modal-footer {
            background-color: #374151;
            border-top-color: #4b5563;
        }

        .dark-mode .btn-close {
            filter: invert(1);
        }

        .dark-mode .border {
            border-color: #4b5563 !important;
        }

        .dark-mode .border-top {
            border-top-color: #4b5563 !important;
        }

        .dark-mode .border-bottom {
            border-bottom-color: #4b5563 !important;
        }

        .dark-mode .border-left {
            border-left-color: #4b5563 !important;
        }

        .dark-mode .border-right {
            border-right-color: #4b5563 !important;
        }

        .dark-mode .border-info {
            border-color: #60a5fa !important;
        }

        .dark-mode .border-success {
            border-color: #10b981 !important;
        }

        .dark-mode .border-warning {
            border-color: #fbbf24 !important;
        }

        .dark-mode .border-danger {
            border-color: #ef4444 !important;
        }

        .dark-mode .navbar-nav .nav-link {
            color: white !important;
        }

        .dark-mode .navbar-nav .nav-link:hover {
            color: #d1d5db !important;
        }

        .dark-mode .navbar-brand {
            color: white !important;
        }

        .dark-mode .navbar-text {
            color: white !important;
        }

        .dark-mode .navbar {
            background: linear-gradient(135deg, #1f2937, #374151) !important;
        }

        .dark-mode .navbar-toggler {
            border-color: #4b5563;
        }

        .dark-mode .navbar-toggler-icon {
            filter: invert(1);
        }

        .dark-mode small {
            color: #9ca3af !important;
        }

        .dark-mode strong {
            color: white !important;
        }

        .dark-mode em {
            color: white !important;
        }

        .dark-mode .table-striped > tbody > tr:nth-child(odd) {
            background-color: #4b5563;
        }

        .dark-mode .table-hover > tbody > tr:hover {
            background-color: #4b5563;
        }

        .dark-mode .btn-link {
            color: #60a5fa;
        }

        .dark-mode .btn-link:hover {
            color: #93c5fd;
        }

        .dark-mode .breadcrumb {
            background-color: #374151;
        }

        .dark-mode .breadcrumb-item + .breadcrumb-item::before {
            color: #9ca3af;
        }

        .dark-mode .breadcrumb-item a {
            color: #60a5fa;
        }

        .dark-mode .progress {
            background-color: #4b5563;
        }

        .dark-mode .toast {
            background-color: #374151;
            color: white;
        }

        .dark-mode .toast-header {
            background-color: #4b5563;
            color: white;
        }

        .dark-mode .pagination .page-link {
            background-color: #374151;
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .pagination .page-link:hover {
            background-color: #4b5563;
            color: white;
        }

        .dark-mode .pagination .page-item.active .page-link {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .dark-mode .form-label {
            color: white !important;
        }

        .dark-mode .form-text {
            color: #9ca3af !important;
        }

        .dark-mode .input-group-text {
            background-color: #4b5563;
            border-color: #4b5563;
            color: white;
        }

        .dark-mode .form-check-label {
            color: white !important;
        }

        .dark-mode .form-check-input {
            background-color: #374151;
            border-color: #4b5563;
        }

        .dark-mode .form-check-input:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .dark-mode .accordion {
            background-color: #374151;
        }

        .dark-mode .accordion-item {
            background-color: #374151;
            border-color: #4b5563;
        }

        .dark-mode .accordion-header button {
            background-color: #374151;
            color: white;
        }

        .dark-mode .accordion-body {
            background-color: #374151;
            color: white;
        }

        .dark-mode .offcanvas {
            background-color: #374151;
            color: white;
        }

        .dark-mode .offcanvas-header {
            border-bottom-color: #4b5563;
        }

        .dark-mode .nav-tabs .nav-link {
            color: white;
            border-color: #4b5563;
        }

        .dark-mode .nav-tabs .nav-link.active {
            background-color: #374151;
            border-color: #4b5563 #4b5563 #374151;
            color: white;
        }

        .dark-mode .nav-pills .nav-link {
            color: white;
        }

        .dark-mode .nav-pills .nav-link.active {
            background-color: #3b82f6;
        }

        .dark-mode .tab-content {
            background-color: #374151;
            color: white;
        }

        .dark-mode .card-title {
            color: white !important;
        }

        .dark-mode .card-text {
            color: white !important;
        }

        .dark-mode .card-subtitle {
            color: #9ca3af !important;
        }

        .dark-mode .card-link {
            color: #60a5fa !important;
        }

        .dark-mode .blockquote {
            color: white;
        }

        .dark-mode .blockquote-footer {
            color: #9ca3af;
        }

        .dark-mode pre {
            background-color: #1f2937;
            color: white;
            border: 1px solid #4b5563;
        }

        .dark-mode code {
            background-color: #374151;
            color: #f9fafb;
        }

        .dark-mode .table-responsive {
            border-color: #4b5563;
        }

        .dark-mode .table caption {
            color: white;
        }

        .dark-mode hr {
            border-color: #4b5563;
        }

        .payment-card {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .overdue-card {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
            width: 100%;
            max-width: 100%;
        }

        .chart-container canvas {
            max-height: 300px !important;
            max-width: 100% !important;
        }

        /* Reading chart specific styling */
        .reading-chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            margin: 15px 0;
        }

        .reading-chart-container canvas {
            max-height: 250px !important;
            max-width: 100% !important;
        }

        /* General canvas constraint to prevent infinite growth */
        canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Chart.js specific fixes */
        .chartjs-render-monitor {
            max-width: 100% !important;
        }

        /* Enhanced Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -250px;
                width: 250px;
                z-index: 1000;
                transition: left 0.3s ease;
                height: 100vh;
                overflow-y: auto;
            }
            
            .sidebar.show {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px !important;
            }
            
            .container-fluid {
                padding: 0;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .stats-number {
                font-size: 1.5rem;
            }
            
            .table-responsive {
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .btn-group-vertical .btn {
                margin-bottom: 5px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .form-control {
                padding: 10px;
            }
            
            .alert {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 10px !important;
            }
            
            .card-body {
                padding: 15px;
            }
            
            .navbar-brand {
                font-size: 1rem;
            }
            
            .stats-number {
                font-size: 1.3rem;
            }
            
            .table {
                font-size: 0.8rem;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .form-control {
                padding: 8px;
                font-size: 0.9rem;
            }
            
            .modal-dialog {
                margin: 10px;
            }
            
            .dropdown-menu {
                font-size: 0.9rem;
            }
            
            .badge {
                font-size: 0.7rem;
                padding: 4px 8px;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .col-form-label {
                font-size: 0.9rem;
            }
            
            .input-group-text {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .navbar-brand {
                font-size: 0.9rem;
            }
            
            .main-content {
                padding: 8px !important;
            }
            
            .card-body {
                padding: 12px;
            }
            
            .stats-number {
                font-size: 1.2rem;
            }
            
            .table {
                font-size: 0.75rem;
            }
            
            .btn {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
            
            .form-control {
                padding: 6px;
                font-size: 0.85rem;
            }
            
            .alert {
                padding: 8px;
                font-size: 0.8rem;
            }
            
            .chart-container {
                height: 180px;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 80px;
            left: 10px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Table Responsive Enhancements */
        .table-responsive {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .table-responsive {
                border: none;
                box-shadow: none;
            }
            
            .table thead {
                display: none;
            }
            
            .table tbody tr {
                display: block;
                border: 1px solid #ddd;
                margin-bottom: 15px;
                border-radius: 8px;
                padding: 10px;
                background: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .table tbody td {
                display: block;
                text-align: left !important;
                border: none;
                padding: 8px 5px;
                position: relative;
                padding-left: 50%;
            }
            
            .table tbody td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 45%;
                font-weight: bold;
                color: var(--primary-color);
            }
        }

        /* Form Responsive Enhancements */
        @media (max-width: 768px) {
            .row.g-3 > .col-md-6,
            .row.g-3 > .col-md-4,
            .row.g-3 > .col-lg-6,
            .row.g-3 > .col-lg-4 {
                margin-bottom: 15px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .input-group .form-control,
            .input-group .btn {
                border-radius: 8px !important;
                margin-bottom: 5px;
            }
            
            .input-group .input-group-text {
                border-radius: 8px !important;
                text-align: center;
                margin-bottom: 5px;
            }
        }

        /* Card Stack for Mobile */
        @media (max-width: 576px) {
            .card-deck,
            .row .card {
                margin-bottom: 15px;
            }
            
            .card-header {
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            .card-title {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }
        }

        /* Navigation Improvements */
        @media (max-width: 768px) {
            .navbar-nav .nav-link {
                padding: 8px 15px;
            }
            
            .dropdown-menu {
                position: static !important;
                float: none;
                box-shadow: none;
                border: none;
                background: rgba(255,255,255,0.1);
                margin-top: 5px;
            }
            
            .dropdown-menu .dropdown-item {
                color: rgba(255,255,255,0.9);
                padding: 8px 15px;
            }
            
            .dropdown-menu .dropdown-item:hover {
                background: rgba(255,255,255,0.1);
                color: white;
            }
        }

        /* Overlay for mobile sidebar */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .sidebar-overlay.show {
            display: block;
        }

        /* Chat Mobile Responsive */
        @media (max-width: 768px) {
            .chat-container {
                height: 40vh !important;
                min-height: 250px !important;
            }
            
            .message-bubble {
                max-width: 90% !important;
                font-size: 0.9rem;
                padding: 6px 10px !important;
            }
            
            .message-time {
                font-size: 0.7rem;
            }
        }

        /* QR Code Responsive */
        @media (max-width: 576px) {
            .qr-code-container {
                text-align: center;
                padding: 15px;
            }
            
            .qr-code-container img {
                max-width: 250px;
                width: 100%;
                height: auto;
            }
        }

        /* Payment Form Responsive */
        @media (max-width: 768px) {
            .payment-summary {
                font-size: 0.9rem;
                padding: 15px;
            }
            
            .payment-amount {
                font-size: 1.5rem !important;
            }
            
            .btn-payment {
                padding: 12px 20px;
                font-size: 1rem;
                width: 100%;
                margin-bottom: 10px;
            }
        }

        /* Notification List Responsive */
        @media (max-width: 576px) {
            .notification-item {
                padding: 12px;
                margin-bottom: 10px;
            }
            
            .notification-item .card-body {
                padding: 10px;
            }
            
            .notification-date {
                font-size: 0.8rem;
            }
        }

        /* Reading History Responsive */
        @media (max-width: 768px) {
            .reading-chart-container {
                height: 200px !important;
            }
            
            .reading-chart-container canvas {
                max-height: 200px !important;
            }
            
            .reading-stats {
                text-align: center;
                margin-bottom: 15px;
            }
            
            .reading-stats .stat-item {
                margin-bottom: 10px;
            }
        }

        @media (max-width: 576px) {
            .reading-chart-container {
                height: 180px !important;
                margin: 10px 0;
            }
            
            .reading-chart-container canvas {
                max-height: 180px !important;
            }
        }

        /* Admin Panel Responsive */
        @media (max-width: 768px) {
            .admin-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-actions .btn {
                width: 100%;
                justify-content: center;
            }
            
            .renter-card {
                margin-bottom: 15px;
            }
            
            .renter-card .card-body {
                padding: 15px;
            }
        }

        /* File Upload Responsive */
        @media (max-width: 576px) {
            .file-upload-area {
                padding: 20px 15px;
                text-align: center;
            }
            
            .file-upload-area .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .upload-preview {
                max-width: 100%;
                margin-top: 15px;
            }
        }

        /* Loading and Progress Responsive */
        @media (max-width: 768px) {
            .loading-spinner {
                scale: 0.8;
            }
            
            .progress-container {
                margin: 10px 0;
            }
            
            .progress {
                height: 8px;
            }
        }

        /* Dashboard Cards Responsive Enhancement */
        @media (max-width: 1200px) {
            .stats-card .card-body {
                padding: 1.2rem;
            }
            
            .stats-number {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 992px) {
            .stats-card .card-body {
                padding: 1rem;
            }
            
            .stats-number {
                font-size: 1.6rem;
            }
        }

        /* Utility Classes for Mobile */
        .mobile-hidden {
            display: block;
        }
        
        .mobile-only {
            display: none;
        }

        @media (max-width: 768px) {
            .mobile-hidden {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
            
            .mobile-center {
                text-align: center;
            }
            
            .mobile-full-width {
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-home me-2"></i>
                Rent & Billing System
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('chat_dashboard') }}" id="chat-link">
                                <i class="fas fa-comments me-1"></i>Chat
                                <span id="chat-badge" class="badge bg-danger ms-1" style="display: none;">0</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i>
                                {{ current_user.username }}
                                {% if current_user.is_admin %}
                                    <span class="badge bg-warning ms-1">Admin</span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="toggleDarkMode()">
                                    <i class="fas fa-moon me-2"></i>Dark Mode
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i>Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('register') }}">
                                <i class="fas fa-user-plus me-1"></i>Register
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <!-- Mobile Menu Toggle Button -->
        {% if current_user.is_authenticated %}
        <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>
        {% endif %}
        
        <div class="row">
            {% if current_user.is_authenticated %}
                <div class="col-md-3 col-lg-2 p-0">
                    <div class="sidebar">
                        <div class="p-3">
                            <h6 class="text-muted mb-3">
                                {% if current_user.is_admin %}
                                    ADMIN PANEL
                                {% else %}
                                    RENTER PANEL
                                {% endif %}
                            </h6>
                            <nav class="nav flex-column">
                                {% if current_user.is_admin %}
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard' }}" href="{{ url_for('admin_dashboard') }}">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_renters' }}" href="{{ url_for('admin_renters') }}">
                                        <i class="fas fa-users me-2"></i>Renters
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_profiles' }}" href="{{ url_for('admin_profiles') }}">
                                        <i class="fas fa-id-card me-2"></i>Profiles
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_pending_payments' }}" href="{{ url_for('admin_pending_payments') }}">
                                        <i class="fas fa-file-alt me-2"></i>Documents
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'add_meter_reading' }}" href="{{ url_for('add_meter_reading') }}">
                                        <i class="fas fa-bolt me-2"></i>Add Reading
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_reading_history' }}" href="{{ url_for('admin_reading_history') }}">
                                        <i class="fas fa-history me-2"></i>Reading History
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint in ['admin_historical_data', 'admin_historical_rent_payment', 'admin_historical_electricity_payment', 'admin_cash_payment_notifications'] }}" href="{{ url_for('admin_historical_data') }}">
                                        <i class="fas fa-database me-2"></i>Historical Data
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_payment_history' }}" href="{{ url_for('admin_payment_history') }}">
                                        <i class="fas fa-table me-2"></i>Payment History
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_payment_history_table' }}" href="{{ url_for('admin_payment_history_table') }}">
                                        <i class="fas fa-th-list me-2"></i>Payment Table
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_user_payment_history' }}" href="{{ url_for('admin_user_payment_history') }}">
                                        <i class="fas fa-receipt me-2"></i>User Payment History
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'chat_dashboard' }}" href="{{ url_for('chat_dashboard') }}">
                                        <i class="fas fa-comments me-2"></i>Chat
                                        <span id="admin-chat-badge" class="badge bg-danger ms-1" style="display: none;">0</span>
                                    </a>
                                    <a class="nav-link {{ 'active' if request.endpoint == 'admin_settings' }}" href="{{ url_for('admin_settings') }}">
                                        <i class="fas fa-cog me-2"></i>Settings
                                    </a>
                                {% else %}
                                    <a class="nav-link" href="{{ url_for('renter_dashboard', mode=request.args.get('mode', 'complex')) }}">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                    {% if request.args.get('mode') != 'simple' %}
                                    <a class="nav-link" href="{{ url_for('user_profile') }}">
                                        <i class="fas fa-user me-2"></i>My Profile
                                    </a>
                                    <a class="nav-link" href="{{ url_for('user_documents') }}">
                                        <i class="fas fa-file-alt me-2"></i>My Documents
                                    </a>
                                    <a class="nav-link" href="{{ url_for('renter_notifications') }}">
                                        <i class="fas fa-bell me-2"></i>Notifications
                                    </a>
                                    <a class="nav-link" href="{{ url_for('renter_payment_receipts') }}">
                                        <i class="fas fa-table me-2"></i>Payment History
                                    </a>
                                    <a class="nav-link" href="{{ url_for('renter_cash_payment') }}">
                                        <i class="fas fa-money-bill-wave me-2"></i>Cash Payment
                                    </a>
                                    <a class="nav-link" href="{{ url_for('renter_cash_payment') }}">
                                        <i class="fas fa-money-bill-wave me-2"></i>Cash Payment
                                    </a>
                                    <a class="nav-link" href="{{ url_for('chat_dashboard') }}">
                                        <i class="fas fa-comments me-2"></i>Chat
                                        <span id="renter-chat-badge" class="badge bg-danger ms-1" style="display: none;">0</span>
                                    </a>
                                    {% else %}
                                    <a class="nav-link" href="{{ url_for('user_profile', mode='simple') }}">
                                        <i class="fas fa-user me-2"></i>My Profile
                                    </a>
                                    <a class="nav-link" href="{{ url_for('renter_cash_payment') }}">
                                        <i class="fas fa-money-bill-wave me-2"></i>Cash Payment
                                    </a>
                                    {% endif %}
                                {% endif %}
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="col-md-9 col-lg-10">
            {% else %}
                <div class="col-12">
            {% endif %}
                    <div class="main-content p-4">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}

                        {% block content %}{% endblock %}
                    </div>
                </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // Mobile Sidebar Functions
        function toggleMobileSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const toggleBtn = document.getElementById('mobileMenuToggle');
            
            if (sidebar && overlay && toggleBtn) {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('show');
                
                // Change icon
                const icon = toggleBtn.querySelector('i');
                if (sidebar.classList.contains('show')) {
                    icon.className = 'fas fa-times';
                } else {
                    icon.className = 'fas fa-bars';
                }
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const toggleBtn = document.getElementById('mobileMenuToggle');
            
            if (sidebar && overlay && toggleBtn) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
                
                // Reset icon
                const icon = toggleBtn.querySelector('i');
                icon.className = 'fas fa-bars';
            }
        }

        // Close sidebar when clicking on nav links (mobile)
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        closeMobileSidebar();
                    }
                });
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeMobileSidebar();
                }
            });

            // Add data labels to table cells for mobile view
            const tables = document.querySelectorAll('.table');
            tables.forEach(table => {
                const headers = table.querySelectorAll('thead th');
                const rows = table.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    cells.forEach((cell, index) => {
                        if (headers[index]) {
                            cell.setAttribute('data-label', headers[index].textContent);
                        }
                    });
                });
            });
        });

        // Auto-dismiss alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                if (alert.classList.contains('show')) {
                    alert.classList.remove('show');
                }
            });
        }, 5000);

        // Check for unread chat messages
        function updateChatBadge() {
            fetch('/api/chat/unread_count')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('chat-badge');
                    if (badge && data.unread_count > 0) {
                        badge.textContent = data.unread_count;
                        badge.style.display = 'inline-block';
                    } else if (badge) {
                        badge.style.display = 'none';
                    }
                })
                .catch(error => console.error('Error updating chat badge:', error));
        }

        // Update chat badge on page load and periodically
        {% if current_user.is_authenticated %}
        document.addEventListener('DOMContentLoaded', updateChatBadge);
        setInterval(updateChatBadge, 30000); // Update every 30 seconds
        {% endif %}

        // Touch swipe functionality for mobile sidebar
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', function(e) {
            if (!touchStartX || !touchStartY) {
                return;
            }

            let touchEndX = e.touches[0].clientX;
            let touchEndY = e.touches[0].clientY;

            let diffX = touchStartX - touchEndX;
            let diffY = touchStartY - touchEndY;

            // Swipe from left edge to open sidebar
            if (Math.abs(diffX) > Math.abs(diffY) && window.innerWidth <= 768) {
                if (diffX < -50 && touchStartX < 50) { // Swipe right from left edge
                    const sidebar = document.querySelector('.sidebar');
                    if (sidebar && !sidebar.classList.contains('show')) {
                        toggleMobileSidebar();
                    }
                }
                // Swipe left to close sidebar
                else if (diffX > 50) {
                    const sidebar = document.querySelector('.sidebar');
                    if (sidebar && sidebar.classList.contains('show')) {
                        closeMobileSidebar();
                    }
                }
            }

            touchStartX = 0;
            touchStartY = 0;
        });

        // Chart.js size protection function
        function initializeChartProtection() {
            // Override Chart.js resize behavior to prevent infinite growth
            if (window.Chart) {
                Chart.defaults.responsive = true;
                Chart.defaults.maintainAspectRatio = true;
                
                // Add resize observer to charts
                const chartContainers = document.querySelectorAll('.reading-chart-container, .chart-container');
                chartContainers.forEach(container => {
                    const canvas = container.querySelector('canvas');
                    if (canvas) {
                        // Set maximum dimensions
                        canvas.style.maxWidth = '100%';
                        canvas.style.maxHeight = container.style.height || '250px';
                        
                        // Prevent canvas from growing beyond container
                        const resizeObserver = new ResizeObserver(entries => {
                            for (let entry of entries) {
                                const container = entry.target;
                                const canvas = container.querySelector('canvas');
                                if (canvas) {
                                    const maxWidth = container.clientWidth;
                                    const maxHeight = parseInt(container.style.height) || 250;
                                    
                                    if (canvas.width > maxWidth) {
                                        canvas.style.width = maxWidth + 'px';
                                    }
                                    if (canvas.height > maxHeight) {
                                        canvas.style.height = maxHeight + 'px';
                                    }
                                }
                            }
                        });
                        
                        resizeObserver.observe(container);
                    }
                });
            }
        }

        // Initialize chart protection when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeChartProtection);
        
        // Re-initialize when new content is loaded
        document.addEventListener('htmx:afterSwap', initializeChartProtection);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
